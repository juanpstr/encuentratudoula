name: ğŸš€ Build para Hostinger Git Deploy

on:
  push:
    branches: [ main ]
  workflow_dispatch: # Permite ejecutar manualmente desde GitHub

jobs:
  build-and-deploy:
    name: ğŸ“¦ Build y Push para Hostinger
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout cÃ³digo
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Instalar dependencias
      run: npm ci
      
    - name: ğŸ—ï¸ Build proyecto
      run: |
        echo "Building for production..."
        npm run build
        cp .htaccess dist/
      env:
        VITE_USE_LOCAL_DATA_ONLY: 'true'
        VITE_APP_ENV: 'production'
      
    - name: ğŸŒ Deploy a rama build para Hostinger
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        # Crear rama build si no existe
        git checkout -B build
        
        # Limpiar archivos previos pero mantener dist/
        find . -maxdepth 1 ! -name 'dist' ! -name '.git' ! -name '.github' ! -name '.' -exec rm -rf {} + 2>/dev/null || true
        
        # Mover archivos de dist/ a la raÃ­z
        mv dist/* .
        mv dist/.htaccess . 2>/dev/null || true
        rm -rf dist/
        
        # Commit y push
        git add .
        git commit -m "ğŸš€ Auto-deploy: $(date '+%Y-%m-%d %H:%M:%S')" || exit 0
        git push -f origin build
          
    - name: âœ… Deploy completado
      run: |
        echo "ğŸ‰ Build completado y pusheado a rama 'build'!"
        echo "ğŸŒ Hostinger detectarÃ¡ el cambio automÃ¡ticamente"
        echo "â° Deploy time: $(date)"
        echo "ğŸ”„ El webhook de Hostinger actualizarÃ¡ tu web en unos minutos"
